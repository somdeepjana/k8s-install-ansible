---
# tasks file for crio
- name: Install packages bace required packages
  yum:
    name: "{{ packages }}"
    state: present
  vars:
    packages:
      - ca-certificates
      - curl

- name: Add base crio container runtime repo
  get_url:
    url: https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/{{ crio_os }}/devel:kubic:libcontainers:stable.repo
    dest: /etc/yum.repos.d/devel:kubic:libcontainers:stable.repo
    force: yes

- name: Add crio main repo
  get_url:
    url: https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable:cri-o:{{ crio_version }}/{{ crio_os }}/devel:kubic:libcontainers:stable:cri-o:{{ crio_version }}.repo
    dest: /etc/yum.repos.d/devel:kubic:libcontainers:stable:cri-o:{{ crio_version }}.repo
    force: yes

- name: Install crio
  yum:
    name: cri-o
    state: present

- name: Enable and start crio service
  systemd:
    name: crio
    enabled: yes
    state: started

- name: Install crictl
  yum:
    name: crictl
    state: present